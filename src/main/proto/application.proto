syntax = "proto3";

option java_multiple_files = true;

package cz.strazovan.dsv;

message Empty {

}

message RegisterNode {
    NodeId nodeId = 1;
}

message NewNode {
    NodeId nodeId = 1;
}

message RegisterNodeResponse {
    repeated NodeId id = 1;
}

message DataChange {
    string data = 1;
}

message LockRequest {
    NodeId id = 1;
    int64 requestTimestamp = 2;
}

message LockReply {
    NodeId id = 1;
}

message DeadNodeDiscovered {
    NodeId id = 1;
}

message NodeId {
    string ip = 1;
    int32 port = 2;
}

service SharedVariableService {
    rpc register (RegisterNode) returns (Empty);
    rpc registrationDone (RegisterNodeResponse) returns (Empty);
    rpc newNode (NewNode) returns (Empty);
    rpc dataChange (DataChange) returns (Empty);
    rpc lockRequest (LockRequest) returns (Empty);
    rpc lockReply (LockReply) returns (Empty);
    rpc reportDeadNode (DeadNodeDiscovered) returns (Empty);
}

